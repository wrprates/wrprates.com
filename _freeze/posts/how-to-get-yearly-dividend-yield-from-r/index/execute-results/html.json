{
  "hash": "9a22f1f84d0b38c07a53871e783c207d",
  "result": {
    "markdown": "---\ntitle: \"Unlocking the Highest-Paying Dividend Stocks with R?\"\nauthor: \"Wlademir Ribeiro Prates\"\ndate: \"2023-10-09\"\ncategories: [Data Visualization, Finance]\nimage: preview.png\nformat:\n  html:\n    include-after-body: disqus.html\n---\n\n\nInvesting in stocks is more than just looking at price appreciation. Dividends are a crucial part of the equation.\n\nEspecially for investors who prioritize income generation, knowing the dividends a stock yields year-over-year can be invaluable. In this post, I'll guide you through a streamlined method using R to pull yearly dividend data for any stock. \n\n**Dividends** are payments made by corporations to their shareholders, often as a distribution of profits. When analyzing stocks from a long-term perspective, dividends can make a significant difference in the total returns an investor receives.\n\n**In this blog post, you will discover**:\n\n- How to pull yearly dividends data for stocks using R.\n- Fetching the closing price of the stock at the end of each year.\n- Calculating yearly yield based on dividends and the closing price.\n\n**R tools and techniques covered here**:\n\n- Leveraging the `quantmod` package to pull stock data.\n- Employing the `dplyr` package for data wrangling.\n- Using `purrr` for functional programming within R.\n\n\nRecently I've posted a video on my YouTube channel about this subject. If you are Portuguese speaker (or want to try the automated subtitles) please check it out. But the same content is also available here in this blog post, even with more details.\n\n<center>\n<iframe width=\"100%\" height=\"370\" src=\"https://www.youtube.com/embed/g2L67Nk2zFY?si=w4KAsVzWZuc1Uuq6\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen></iframe>\n</center>\n\n## Fetching Yearly Dividends\n\nTo get yearly dividends for a stock, we make use of the `quantmod` package which interfaces with various sources online to fetch stock data. Here's the code chunk to pull yearly dividends:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(quantmod)\nlibrary(dplyr)\n\nget_yearly_dividends <- function(ticker, years) {\n  historical_dividends <- quantmod::getDividends(\n    Symbol = ticker,\n    from = paste0(min(years), \"-01-01\"),\n    to = paste0(max(years), \"-12-31\")\n  ) |>\n    setNames(\"dividends\")\n  \n  yearly_data <- historical_dividends |>\n    dplyr::as_tibble(rownames = \"date\") |>\n    dplyr::mutate(\n      ticker = gsub(\".SA\", \"\", ticker),\n      year = lubridate::year(date)\n    ) |>\n    group_by(year) |>\n    dplyr::summarise(\n      dividends = sum(dividends)\n    )\n  \n  return(yearly_data)\n}\n\n# Example for Coca-Cola Co.\nget_yearly_dividends(\"KO\", c(2020:2023))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 2\n   year dividends\n  <dbl>     <dbl>\n1  2020      1.64\n2  2021      1.68\n3  2022      1.76\n4  2023      1.38\n```\n:::\n:::\n\n\n\n## Getting Yearly Closing Price\n\nWhile dividends tell half the story, to evaluate the attractiveness of the dividends, we need to know at what price the stock closed at the end of each year. Here's how we can fetch that data:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nget_yearly_closing_price <- function(ticker, years) {\n  historical_prices <- quantmod::getSymbols(\n    Symbol = ticker,\n    from = paste0(min(years), \"-01-01\"),\n    to = paste0(max(years), \"-12-31\"),\n    auto.assign = FALSE\n  ) |>\n    dplyr::as_tibble(rownames = \"date\") |>\n    dplyr::select(date, tidyr::contains(\"Adjusted\")) |>\n    setNames(c(\"date\", \"price\")) |>\n    dplyr::mutate(\n      ticker = gsub(\".SA\", \"\", ticker),\n      year = lubridate::year(date)\n    ) |>\n    group_by(year) |>\n    dplyr::summarise(\n      price = last(price)\n    )\n  return(historical_prices)\n}\n\n# Example for Coca-Cola Co.\nget_yearly_closing_price(\"KO\", c(2020:2023))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 2\n   year price\n  <dbl> <dbl>\n1  2020  50.5\n2  2021  56.2\n3  2022  62.2\n4  2023  52.5\n```\n:::\n:::\n\n\n\n## Calculating Yearly Yield\n\nCombining the dividends and the closing price, we can calculate the yield for the stock year-over-year:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nget_yearly_yield <- function(ticker, years) {\n  yearly_yields <- get_yearly_dividends(ticker, years) |>\n    dplyr::left_join(\n      get_yearly_closing_price(ticker, years),\n      by = \"year\"\n    ) |>\n    dplyr::mutate(\n      ticker = gsub(\".SA\", \"\", ticker),\n      yield = round(100 * dividends / price, 4)\n    )\n  \n  return(yearly_yields)\n}\n\n# Example for Coca-Cola Co.\nget_yearly_yield(\"KO\", c(2020:2023))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n   year dividends price ticker yield\n  <dbl>     <dbl> <dbl> <chr>  <dbl>\n1  2020      1.64  50.5 KO      3.25\n2  2021      1.68  56.2 KO      2.99\n3  2022      1.76  62.2 KO      2.83\n4  2023      1.38  52.5 KO      2.63\n```\n:::\n:::\n\n\n## Practical Examples\n\nIn this section, we will select various tickers, gather their data, and then filter for stocks that **consistently paid dividends throughout our chosen period**. Additionally, we'll set a **threshold to only include stocks with an average yearly dividend yield of 8% or higher**.\n\nWe'll demonstrate this approach using both American and Brazilian stocks.\n\nLet's apply this example to some American stocks, and also to some Brazillian stocks.\n\n### Yearly Dividend Yield Analysis for Selected - American Stocks\n\nTickers extracted from these blog posts: [US News](https://money.usnews.com/investing/dividends/slideshows/best-dividend-stocks-to-buy-this-year); [NerdWallet](https://www.nerdwallet.com/article/investing/how-to-invest-dividend-stocks)\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(purrr)\n\ntickers <- c(\n  \"XOM\", # Exxon Mobil Corp.\n  \"KO\", # Coca-Cola Co. \n  \"PFE\", # Pfizer Inc.\n  \"WFC\", # Wells Fargo & Co.\n  \"KMB\", # Kimberly-Clark Corp.\n  \"PDM\",  # Piedmont Office Realty Trust Inc\n  \"BGFV\", # Big 5 Sporting Goods Corp\n  \"ARI\",  # Apollo Commercial Real Estate Finance Inc\n  \"REFI\", # Chicago Atlantic Real Estate Finance Inc\n  \"DX\",   # Dynex Capital, Inc.\n  \"BRBS\", # Blue Ridge Bankshares Inc (VA)\n  \"CFFN\", # Capitol Federal Financial\n  \"RGR\",  # Sturm, Ruger & Co., Inc.\n  \"ABR\"   # Arbor Realty Trust Inc.\n)\n\nyears <- c(2017:2023)\n\nstock_data_list <- purrr::map(\n  tickers,\n  get_yearly_yield,\n  years\n) |> \n  setNames(tickers)\n```\n:::\n\n\n\nNow, let's visualize the yearly dividend yield for these stocks:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# Loading necessary packages\nlibrary(echarts4r)\nlibrary(tidyr)\n\nchart_color_pallete <- c(\n  \"#212529\",  # Main color\n  \"#A89F91\",  # Warm gray\n  \"#1C3A70\",  # Deep blue\n  \"#B0CCE1\",  # Soft sky blue\n  \"#D1495B\",  # Bright red (For contrast and pop)\n  \"#F9C74F\",  # Golden yellow\n  \"#43AA8B\",  # Teal green\n  \"#F8961E\",  # Bright orange\n  \"#6A0572\",  # Deep purple\n  \"#577590\",  # Muted blue\n  \"#F9844A\",  # Coral\n  \"#1982C4\",  # Cerulean blue\n  \"#6B4226\",  # Brown (earthy tone)\n  \"#3B3F45\",  # Slightly lighter shade of the base\n  \"#0A0C0F\"  # Darker, almost black, shade\n)\n\nrange_years <- max(years) - min(years) - 1\n\n# Transforming the data for plotting\nstock_data <- stock_data_list |>\n  bind_rows(.id = \"ticker\") |>\n  mutate(year = as.factor(year)) |>\n  # Keeping only highest mean yields\n  group_by(ticker) |>\n   mutate(\n    yield_mean = mean(yield, na.rm = TRUE),\n    total_years = length(unique(year))\n  ) |>\n  filter(yield_mean >= 8 && total_years >= range_years) |>\n  ungroup() |>\n  arrange(year)\n\nstock_data |>\n  group_by(ticker) |>\n  e_charts(year) |>\n  e_line(yield) |>\n  e_y_axis(name = \"Yield (%)\") |>\n  e_tooltip(trigger = \"axis\") |>\n  e_color(chart_color_pallete) |>\n  e_hide_grid_lines(which = \"y\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-67daf4587dc75f893233\" style=\"width:100%;height:500px;\" class=\"echarts4r html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-67daf4587dc75f893233\">{\"x\":{\"theme\":\"\",\"tl\":false,\"draw\":true,\"renderer\":\"canvas\",\"events\":[],\"buttons\":[],\"opts\":{\"yAxis\":[{\"show\":true,\"name\":\"Yield (%)\",\"splitLine\":{\"show\":false}}],\"xAxis\":[{\"data\":[\"2017\",\"2018\",\"2019\",\"2020\",\"2021\",\"2022\",\"2023\"],\"type\":\"category\",\"boundaryGap\":true}],\"legend\":{\"data\":[\"ABR\",\"ARI\",\"BGFV\",\"CFFN\",\"DX\"]},\"series\":[{\"data\":[{\"value\":[\"2017\",\"14.4629\"]},{\"value\":[\"2018\",\"15.7862\"]},{\"value\":[\"2019\",\"11.4813\"]},{\"value\":[\"2020\",\"11.2572\"]},{\"value\":[\"2021\",\" 9.0588\"]},{\"value\":[\"2022\",\"12.7522\"]},{\"value\":[\"2023\",\" 8.7596\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"ABR\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2017\",\"19.6331\"]},{\"value\":[\"2018\",\"19.6396\"]},{\"value\":[\"2019\",\"16.2115\"]},{\"value\":[\"2020\",\"18.0002\"]},{\"value\":[\"2021\",\"13.4037\"]},{\"value\":[\"2022\",\"14.4306\"]},{\"value\":[\"2023\",\"10.1547\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"ARI\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2017\",\"12.7222\"]},{\"value\":[\"2018\",\"28.6710\"]},{\"value\":[\"2019\",\" 9.1278\"]},{\"value\":[\"2020\",\" 3.1950\"]},{\"value\":[\"2021\",\"17.5665\"]},{\"value\":[\"2022\",\"12.4026\"]},{\"value\":[\"2023\",\"10.0536\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"BGFV\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2017\",\" 9.7010\"]},{\"value\":[\"2018\",\"10.5104\"]},{\"value\":[\"2019\",\" 8.6731\"]},{\"value\":[\"2020\",\" 4.6265\"]},{\"value\":[\"2021\",\" 9.6468\"]},{\"value\":[\"2022\",\" 9.8505\"]},{\"value\":[\"2023\",\" 5.4721\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"CFFN\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2017\",\"57.6519\"]},{\"value\":[\"2018\",\"62.9771\"]},{\"value\":[\"2019\",\"33.3217\"]},{\"value\":[\"2020\",\"12.3991\"]},{\"value\":[\"2021\",\"11.3958\"]},{\"value\":[\"2022\",\"13.4683\"]},{\"value\":[\"2023\",\"10.0257\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"DX\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"}],\"tooltip\":{\"trigger\":\"axis\"},\"color\":[\"#212529\",\"#A89F91\",\"#1C3A70\",\"#B0CCE1\",\"#D1495B\",\"#F9C74F\",\"#43AA8B\",\"#F8961E\",\"#6A0572\",\"#577590\",\"#F9844A\",\"#1982C4\",\"#6B4226\",\"#3B3F45\",\"#0A0C0F\"]},\"dispose\":true},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n#### Yearly Dividend Yield Analysis for Selected - Brazillian Stocks\n\nTickers extracted from this [blog post](https://blog.toroinvestimentos.com.br/bolsa/maiores-pagadoras-de-dividendos):\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ntickers <- c(\n  \"CSNA3\",  # CSN\n  \"SLCE3\",  # SLC Agrícola\n  \"CPFE3\",  # CPFL Energia\n  \"BBSE3\",  # BB Seguridade\n  \"ENBR3\",  # Energias do Brasil\n  \"JBSS3\",  # JBS\n  \"BRAP4\",  # Bradespar\n  \"BBDC4\",  # Bradesco\n  \"USIM5\",  # Usiminas\n  \"BBAS3\",  # Banco do Brasil\n  \"VIVT3\",  # Telefônica\n  \"EGIE3\",  # Engie\n  \"CMIG4\",  # Cemig\n  \"TAEE11\", # Taesa\n  \"GOAU4\",  # Gerdau Metalúrgica\n  \"ELET6\",  # Eletrobras\n  \"BEEF3\",  # Minerva\n  \"VALE3\",  # Vale\n  \"SANB11\", # Santander\n  \"GGBR4\"   # Gerdau\n)\n\nyears <- c(2017:2023)\n\nstock_data_list <- purrr::map(\n  paste0(tickers, \".SA\"),\n  get_yearly_yield,\n  years\n) |> \n  setNames(tickers)\n```\n:::\n\n\n\nNow, let's visualize the yearly dividend yield for these stocks:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nrange_years <- max(years) - min(years) - 1\n\n# Transforming the data for plotting\nstock_data <- stock_data_list |>\n  bind_rows(.id = \"ticker\") |>\n  mutate(year = as.factor(year)) |>\n  # Keeping only highest mean yields\n  group_by(ticker) |>\n  mutate(\n    yield_mean = mean(yield, na.rm = TRUE),\n    total_years = length(unique(year))\n  ) |>\n  filter(yield_mean >= 8 && total_years >= range_years) |>\n  ungroup() |>\n  arrange(year)\n\nstock_data |>\n  group_by(ticker) |>\n  e_charts(year) |>\n  e_line(yield) |>\n  e_y_axis(name = \"Yield (%)\") |>\n  e_tooltip(trigger = \"axis\") |>\n  e_color(chart_color_pallete) |>\n  e_hide_grid_lines(which = \"y\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-44d65fec9ee79c860677\" style=\"width:100%;height:500px;\" class=\"echarts4r html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-44d65fec9ee79c860677\">{\"x\":{\"theme\":\"\",\"tl\":false,\"draw\":true,\"renderer\":\"canvas\",\"events\":[],\"buttons\":[],\"opts\":{\"yAxis\":[{\"show\":true,\"name\":\"Yield (%)\",\"splitLine\":{\"show\":false}}],\"xAxis\":[{\"data\":[\"2017\",\"2018\",\"2019\",\"2020\",\"2021\",\"2022\",\"2023\"],\"type\":\"category\",\"boundaryGap\":true}],\"legend\":{\"data\":[\"BBSE3\",\"BRAP4\",\"CPFE3\",\"CSNA3\",\"EGIE3\",\"TAEE11\",\"VIVT3\"]},\"series\":[{\"data\":[{\"value\":[\"2017\",\" 9.5247\"]},{\"value\":[\"2018\",\"16.5436\"]},{\"value\":[\"2019\",\" 5.8847\"]},{\"value\":[\"2020\",\"17.3738\"]},{\"value\":[\"2021\",\" 5.7364\"]},{\"value\":[\"2022\",\" 6.4677\"]},{\"value\":[\"2023\",\"10.9802\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"BBSE3\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2017\",\" 8.0804\"]},{\"value\":[\"2018\",\" 6.3566\"]},{\"value\":[\"2019\",\" 7.8611\"]},{\"value\":[\"2020\",\" 4.4525\"]},{\"value\":[\"2021\",\"45.5229\"]},{\"value\":[\"2022\",\"11.5908\"]},{\"value\":[\"2023\",\" 5.5358\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"BRAP4\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2017\",\" 1.7859\"]},{\"value\":[\"2018\",\" 1.4963\"]},{\"value\":[\"2019\",\" 2.0842\"]},{\"value\":[\"2020\",\"15.1421\"]},{\"value\":[\"2021\",\"16.5497\"]},{\"value\":[\"2022\",\"10.6646\"]},{\"value\":[\"2023\",\" 8.4152\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"CPFE3\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2018\",\"10.4694\"]},{\"value\":[\"2019\",\"14.5316\"]},{\"value\":[\"2020\",\" 0.0712\"]},{\"value\":[\"2021\",\" 9.4318\"]},{\"value\":[\"2022\",\"18.5593\"]},{\"value\":[\"2023\",\" 5.3617\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"CSNA3\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2017\",\" 9.4725\"]},{\"value\":[\"2018\",\"12.0240\"]},{\"value\":[\"2019\",\" 5.4594\"]},{\"value\":[\"2020\",\" 7.5152\"]},{\"value\":[\"2021\",\" 8.2897\"]},{\"value\":[\"2022\",\" 8.4187\"]},{\"value\":[\"2023\",\" 6.5584\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"EGIE3\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2017\",\"14.5869\"]},{\"value\":[\"2018\",\"18.2554\"]},{\"value\":[\"2019\",\" 8.7852\"]},{\"value\":[\"2020\",\"12.4726\"]},{\"value\":[\"2021\",\"14.3650\"]},{\"value\":[\"2022\",\"10.7949\"]},{\"value\":[\"2023\",\" 6.8217\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"TAEE11\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2017\",\"10.6361\"]},{\"value\":[\"2018\",\"11.7913\"]},{\"value\":[\"2019\",\" 7.0936\"]},{\"value\":[\"2020\",\"13.1425\"]},{\"value\":[\"2021\",\" 7.9643\"]},{\"value\":[\"2022\",\" 5.6245\"]},{\"value\":[\"2023\",\" 5.3476\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"VIVT3\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"}],\"tooltip\":{\"trigger\":\"axis\"},\"color\":[\"#212529\",\"#A89F91\",\"#1C3A70\",\"#B0CCE1\",\"#D1495B\",\"#F9C74F\",\"#43AA8B\",\"#F8961E\",\"#6A0572\",\"#577590\",\"#F9844A\",\"#1982C4\",\"#6B4226\",\"#3B3F45\",\"#0A0C0F\"]},\"dispose\":true},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Conclusion\n\nUsing R, we have streamlined the process of fetching and analyzing yearly dividend data for stocks. This method allows investors and analysts to quickly evaluate the attractiveness of dividends over the years. By understanding the yearly yields, one can make better-informed decisions regarding their investments.\n\nFurther, the flexibility and power of R enable the expansion of this analysis. With a similar approach, one could:\n\n- Compare the dividend yield with other financial metrics for a more comprehensive stock evaluation.\n- Predict future dividend yields based on historical data using time-series forecasting techniques.\n- Incorporate external economic factors, such as interest rates or GDP growth, to understand their impact on dividend yields.\n\nRemember, while dividends are a crucial aspect, they are just one part of a holistic analysis when evaluating stocks. Always consider a multitude of factors before making any investment decisions. Happy investing!\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/echarts4r-4.8.0/echarts-en.min.js\"></script>\n<script src=\"../../site_libs/echarts4r-4.8.0/ecStat.min.js\"></script>\n<script src=\"../../site_libs/echarts4r-4.8.0/dataTool.min.js\"></script>\n<script src=\"../../site_libs/echarts4r-binding-0.4.4/echarts4r.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}